
  clone:
    depth: full

  image: node:20.11.0

  pipelines:
    branches:
      main:
        
        # - step:
        #     name: Run SonarCloud
        #     script:
        #       - pipe: sonarsource/sonarcloud-scan:2.0.0

        - step:
            name: Install Dependencies & Build Project
            script:
              - npm install
              - npm run build
              - tar -czvf build.tar.gz out
            artifacts:
              - build.tar.gz


        - step:
            name: Deployment
            image: amazon/aws-cli
            script:
            - aws s3 cp build.tar.gz s3://$S3_BUCKET/bundles/
            # - aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID
            # - aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY
            - export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
            - export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
            - |
              aws deploy create-deployment \
                --application-name $APPLICATION_NAME \
                --deployment-config-name $DEPLOYMENT_CONFIG_NAME \
                --deployment-group-name $DEPLOYMENT_GROUP_NAME \
                --file-exists-behavior OVERWRITE \
                --s3-location bucket=$S3_BUCKET,bundleType=tgz,key=bundles/build.tar.gz


        
        # - step:
        #     name: Deploy to Netlify
        #     deployment: production
        #     script:
        #       - |
        #         curl -H "Content-Type: application/zip" \
        #            -H "Authorization: Bearer nfp_oEEdNxckaew7wrUAS8WoAb3xC8bTX8Pf3249" \
        #            --data-binary "@website.zip" \
        #            https://api.netlify.com/api/v1/sites/getyourguide.netlify.app/deploys

    pull-requests:
      '**':
        - step:
            name: Run SonarCloud
            script:
              - pipe: sonarsource/sonarcloud-scan:2.0.0





  # clone:
  #   depth: full

  # image: node:20.11.0
  # pipelines:
  #   branches:
  #     main:
  #       - step:
  #           name: Install Node.js 20 and dependencies
  #           script:
  #             - npm install
  #           artifacts:
  #             - .node_modules/**              
  #       # - step:
  #       #     name: Run SonarCloud
  #       #     script:
  #       #       - pipe: sonarsource/sonarcloud-scan:2.0.0

  #       - step:
  #           name: Build Project & Zip
  #           script:
  #             - npm install
  #             - npm run build
  #           artifacts:
  #             - out/**


  #       - step:
  #           name: Zip .next Folder
  #           script:
  #             - apt-get update && apt-get install -y zip
  #             - zip -r website.zip out/
  #           artifacts:
  #             - website.zip

  #       - step:
  #           name: Deploy to Netlify
  #           deployment: production
  #           script:
  #             - |
  #               curl -H "Content-Type: application/zip" \
  #                  -H "Authorization: Bearer nfp_oEEdNxckaew7wrUAS8WoAb3xC8bTX8Pf3249" \
  #                  --data-binary "@website.zip" \
  #                  https://api.netlify.com/api/v1/sites/getyourguide.netlify.app/deploys

  #   pull-requests:
  #     '**':
  #       - step:
  #           name: Run SonarCloud
  #           script:
  #             - pipe: sonarsource/sonarcloud-scan:2.0.0

